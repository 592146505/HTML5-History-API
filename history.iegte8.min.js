/*
 * history API JavaScript Library v3.1.2 beta
 *
 * Support: IE8+, FF3+, Opera 9+, Safari, Chrome
 *
 * Copyright 2011-2012, Dmitriy Pakhtinov ( spb.piksel@gmail.com )
 *
 * http://spb-piksel.ru/
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Update: 12-09-2012
 */
(function(d,w,n,j,P){function D(a,g,b){var e=2===a?d.onhashchange:d.onpopstate,c=2===a?"hashchange":"popstate",h=u[c];p.createEvent?(a=p.createEvent("Events"),a.initEvent(c,n,n)):(a=p.createEventObject(),a.type=c);a.state=k.state;a.oldURL=g;a.newURL=b;e&&e.call(d,a);g=0;for(b=h.length;g<b;g++)h[g].call(d,a)}function I(a){return E?a?E.setItem("__hitoryapi__",x.stringify(a)):x.parse(E.getItem("__hitoryapi__"))||{}:{}}function J(a,g,b){var e=a,c,h=n;if(y||z)for(c in g){if(q.call(g,c))if(z)g[c].get&&
z.call(a,c,g[c].get),g[c].set&&U.call(a,c,g[c].set);else if(y)try{y(a,c,g[c])}catch(l){if(b)return n;h=w;break}}else h=w;if(h&&v){b="StaticClass"+V+v++;e=["Class "+b];"execVB"in d||execScript("Function execVB(c) ExecuteGlobal(c) End Function","VBScript");"VBCVal"in d||execScript("Function VBCVal(o,r) If IsObject(o) Then Set r=o Else r=o End If End Function","VBScript");for(c in a)e[e.length]="Public ["+c+"]";q.call(a,"toString")&&(a.propertyIsEnumerable("toString")||(e[e.length]="Public [toString]"),
g["(toString)"]={get:function(){return this.toString.call(this)}});for(c in g)if(q.call(g,c)&&(g[c].get&&(a["get "+c]=g[c].get,e.push("Public [get "+c+"]","Public "+("(toString)"===c?"Default ":"")+"Property Get ["+c+"]","Call VBCVal(me.[get "+c+"].call(me),["+c+"])","End Property")),g[c].set))a["set "+c]=g[c].set,e.push("Public [set "+c+"]","Public Property Let ["+c+"](v)","Call me.[set "+c+"].call(me,v)","End Property","Public Property Set ["+c+"](v)","Call me.[set "+c+"].call(me,v)","End Property");
e.push("End Class","Function "+b+"Factory()","Set "+b+"Factory=New "+b,"End Function");execVB(e.join("\n"));e=d[b+"Factory"]();for(c in a)e[c]=a[c];q.call(a,"toString")&&(e.toString=a.toString)}return e}var p=d.document,i=d.history||{},b=d.location,l=!!i.pushState,W=l&&i.state===P,t=b.href,x=d.JSON||{},y=Object.defineProperty,z=Object.prototype.__defineGetter__,U=Object.prototype.__defineSetter__,Q=i.pushState,R=i.replaceState,E=d.sessionStorage,q=Object.prototype.hasOwnProperty,r=+((d.eval&&eval("/*@cc_on 1;@*/")&&
/msie (\d+)/i.exec(navigator.userAgent)||[])[1]||0),V=(new Date).getTime(),v=(y||z)&&(!r||8<r)?0:1,A,B,C,K="",L=(A="addEventListener",d[A])||(A="attachEvent",K="on",d[A]),X=(B="removeEventListener",d[B])||(B="detachEvent",d[B]),Y=(C="dispatchEvent",d[C])||(C="fireEvent",d[C]),F=[],S=[],M=0,u={onpopstate:F,popstate:F,onhashchange:S,hashchange:S},s=function(){var a,b,d,e={basepath:"/",redirect:0,type:"/"};d=p.getElementsByTagName("SCRIPT");for(a=0;d[a];a++)if(b=/(.*)\/(?:history|spike)(?:-\d\.\d(?:\.\d)?\w?)?(?:\.min)?.js\?(.*)$/i.exec(d[a].src)||
a===d.length-1&&2===(b=d[a].src.split("?")).length&&(b[2]=b[1])&&b){a=0;for(d=b[2].split("&");d[a];)b=d[a++].split("="),e[b[0]]="true"==b[1]?w:"false"==b[1]?n:b[1]||"";e.basepath=e.basepath||"/";break}return e}(),h=function(a){var d,k,e,c,j,i,m,n=RegExp("^"+s.basepath,"i");return function(f,o){if(f){if(!l)var G=h(),N=G.e,T=G.i,f=/^(?:[a-z]+\:)?\/\//.test(f)?0===f.indexOf("/")?T+f:f:T+"//"+G.h+(0===f.indexOf("/")?f:0===f.indexOf("?")?N+f:0===f.indexOf("#")?N+G.f+f:N.replace(/[^\/]+$/g,"")+f)}else if(f=
b.href,!l||o)f=b.protocol+"//"+b.host+s.basepath+(f.replace(/^[^#]*/,"")||"#").replace(RegExp("^#[/]?(?:"+s.type+")?"),"");if(d!==f){a.href=d=f;i=a.port;j=a.host;m=a.pathname;if("http:"===a.protocol&&80==i||"https:"===a.protocol&&443==i)j=a.hostname,i="";m=0===m.indexOf("/")?m:"/"+m;k=m+a.search+a.hash;c=m.replace(n,s.type)+a.search;e=c+a.hash}return{a:a.protocol+"//"+j+k,i:a.protocol,h:j,j:a.hostname||b.hostname,k:i||b.port,e:m,f:a.search,d:a.hash,b:k,c:c,g:e}}}(p.createElement("a")),k=!v?i:{back:i.back,
forward:i.forward,go:i.go,pushState:j,replaceState:j,emulate:!l,toString:function(){return"[object History]"}},H={state:{get:function(){return I()[k.location.href]||j}},length:{get:function(){return i.length}},location:{set:function(a){d.location=a},get:function(){return l?b:O}}},O={assign:function(a){b.assign(l||0!==a.indexOf("#")?a:"#"+h().c+a)},reload:b.reload,replace:function(a){b.replace(l||0!==a.indexOf("#")?a:"#"+h().c+a)},toString:function(){return this.href}},Z={href:{set:function(a){b.href=
a},get:function(){return h().a}},protocol:{set:function(a){b.protocol=a},get:function(){return b.protocol}},host:{set:function(a){b.host=a},get:function(){return b.host}},hostname:{set:function(a){b.hostname=a},get:function(){return b.hostname}},port:{set:function(a){b.port=a},get:function(){return b.port}},pathname:{set:function(a){b.pathname=a},get:function(){return h().e}},search:{set:function(a){b.search=a},get:function(){return h().f}},hash:{set:function(a){b.hash="#"+h().c+(0===a.indexOf("#")?
a:"#"+a)},get:function(){return h().d}}};(!r||7<r)&&function(){function a(){if(t&&!(t=0)&&q.b!==s.basepath)clearInterval(c),setTimeout(D,10)}var g=d.onpopstate||j,p=d.onhashchange||j,e=0,c=j,q=h(),r=q.a;q.d.replace(/^#/,"");L(K+"hashchange",function(a){var b=h();if(M)return r=b.a,M=0;var d=a.oldURL||r,a=r=a.newURL||b.a,b=d.replace(/^.*?(#|$)/,""),c=a.replace(/^.*?(#|$)/,"");d!=a&&!e&&D();t=e=0;b!=c&&D(2,d,a)},n);L(K+"popstate",function(){if(t===b.href)return t=0;t=0;D(e=1)},n);k.fixURL=function(a){return h(a).b};
k=J(k,v?H:i.state===P?{state:H.state,location:H.location}:{location:H.location});O=J(O,Z);d[A]=function(b,d,c,e){u[b]?(u[b].push(d),!l&&F===u[b]&&a()):L(b,d,c,e)};d[B]=function(a,b,d){var c=u[a];if(c)for(a=c.length;--a;){if(c[a]===b){c.splice(a,1);break}}else X(a,b,d)};d[C]=function(a,b){var c=u[a],e=c===F?d.onpopstate:d.onhashchange;if(c){b=b||("string"==typeof a?d.event:a);try{b&&(b.target=d)}catch(f){try{b.srcElement=d}catch(g){}}e&&e.call(d,b);for(var e=0,h=c.length;e<h;e++)c[e].call(d,b);return w}return Y(a,
b)};v&&execScript("Public history, onhashchange","VBScript");if((!y&&!z||!J(d,{onhashchange:{get:function(){return p},set:function(a){p=a||j}},onpopstate:{get:function(){return g},set:function(b){(g=b||j)&&!l&&a()}}},1))&&!l)c=setInterval(function(){d.onpopstate&&a()},100);if(s.redirect&&d.top==d.self){var m=h(j,w).b,x=b.search,f=b.pathname,o=s.basepath;if(l){if(m!=o&&RegExp("^"+o+"$","i").test(f)&&(b.href=m),!RegExp("^"+o,"i").test(f))b.href=f.replace(/^\//,o)+x}else f!=o&&(b.href=o+"#"+f.replace(RegExp("^"+
o,"i"),s.type)+x+b.hash)}k.pushState=function(a,d,c,e){var f=I(),g=h().a,i=c&&h(c);t=0;c=i?i.a:g;e&&f[g]&&delete f[g];if((!l||W)&&E&&a)f[c]=a,I(f),a=j;Q&&R?e?R.call(k,a,d,c):Q.call(k,a,d,c):i&&i.b!=h().b&&(M=1,e?b.replace("#"+i.g):b.hash=i.g)};k.replaceState=function(a,b,c){k.pushState(a,b,c,1)};v?d.history=k:d.history.emulate=!l}()})(window,!0,!1,null);
