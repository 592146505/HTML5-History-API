/*
 * history API JavaScript Library v2.0.2
 *
 * Support: IE6+, FF3+, Opera 9+, Safari
 *
 * Copyright 2011-2012, Dmitriy Pakhtinov ( spb.piksel@gmail.com )
 *
 * http://spb-piksel.ru/
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Update: 19-03-2012
 */
(function(b,q){function h(a){var i=d.href.split("#"),a=a||i.shift()&&"#"+i.join("#"),i=e.basepath+(a||"#").replace(RegExp("^#[/]?(?:"+e.type+")?"),""),c=(a=i.split("?")).shift(),b=(a=a.join("?").split("#")).shift(),a=a.join("#");return{url:i,href:d.protocol+"//"+d.host+i,protocol:d.protocol,host:d.host,hostname:d.hostname,port:d.port,path:c.replace(/[^\/]+$/g,""),pathname:c,search:b?"?"+b:"",hash:a?"#"+a:"",toString:function(){return this.href}}}function E(){var a=d.pathname;if(v){if(l!=e.basepath&&
RegExp("^"+e.basepath+"$").test(a))b.location=l;if(!RegExp("^"+e.basepath).test(a))b.location=a.replace(/^\//,e.basepath)+d.search}else if(a!=e.basepath)return b.location=e.basepath+"#"+a.replace(RegExp("^"+e.basepath),e.type)+d.search+d.hash,!1;return!0}function w(){if(x&&!(x=!1)&&l!==e.basepath)clearInterval(y),setTimeout(function(){z()},10)}function A(a){function i(a){var c=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
b={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(a){var c=b[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a){var b,e,d;b=(typeof a).charCodeAt(2);if(114==b)a=i(a);else if(109==b)a=isFinite(a)?""+a:"null";else if(111==b||108==b)a=""+a;else if(106==b)if(a){e=(b="[object Array]"===Object.prototype.toString.apply(a))?"[":"{";if(b)for(d=0;d<a.length;d++)e+=
(0==d?"":",")+c(a[d]);else for(d in a)Object.hasOwnProperty.call(a,d)&&a[d]!==q&&(e+=(1==e.length?"":",")+i(d)+":"+c(a[d]));a=e+(b?"]":"}")}else a="null";else a=q;return a}return b.JSON&&JSON.stringify?JSON.stringify(a):c(a)}function p(){var a;if(g)a=g.storage;else{if(a=b.sessionStorage)a=(a=sessionStorage.getItem(h().href))?b.JSON&&JSON.parse?JSON.parse(a):(new Function("return "+a))():null;a=a||B}f.state=a.state;f.title=a.title}function z(){p();if(null!=f.title)j.title=f.title;if(j.createEvent){var a=
j.createEvent("Events");a.initEvent("popstate",!1,!1)}else a=j.createEventObject();a.location=h();a.state=f.state;a.title=f.title;a.srcElement=b;a.type="popstate";b.dispatchEvent?b.dispatchEvent(a):b.fireEvent("popstate",a)}function r(){var a=h().url;l!==a&&(l=a,z())}var v=!(!b.history||!history.pushState),j=b.document,d=b.location,f=b.history||{},l,e=function(){var a,b,c,d={basepath:"/",redirect:!1,type:""};c=j.getElementsByTagName("SCRIPT");for(a=0;c[a];a++)if(b=/(.*)\/history(?:-\d\.\d(?:\.\d\w?)?(?:\.min)?)?.js\?(.*)$/i.exec(c[a].src)){for(a=
0,c=b[2].split("&");c[a];)b=c[a++].split("="),d[b[0]]="true"==b[1]?!0:"false"==b[1]?!1:b[1]||"";break}return d}();l=h().url;if(!(e.redirect&&0===b.parent.frames.length&&!E()||v)){var m,n,o,C=eval("/*@cc_on @_jscript_version;@*/"),D=(m="addEventListener",b[m])||(m="attachEvent",b[m]),F=(n="removeEventListener",b[n])||(n="detachEvent",b[n]),G=(o="dispatchEvent",b[o])||(o="fireEvent",b[o]),B={state:null,title:j.title},s={popstate:1,onpopstate:1},k=[],g,t,x=!0,y;y=setInterval(function(){b.onpopstate&&
"[object Function]"===Object.prototype.toString.call(b.onpopstate)&&w()},100);b[m]=function(a,b,c,d){s[a]?(k.push(b),w()):D(a,b,c,d)};b[n]=function(a,b,c){if(s[a])for(a=k.length;--a;){if(k[a]===b){k.splice(a,1);break}}else F(a,b,c)};b[o]=function(a,d){if(s[a&&a.type||a]){d=d||("string"==typeof a?b.event:a);try{d&&(d.target=b)}catch(c){try{d.srcElement=b}catch(e){}}if(b.onpopstate&&"[object Function]"===Object.prototype.toString.call(b.onpopstate)&&!1===b.onpopstate.call(b,d))return!1;for(var g=0,
h=k.length;g<h;g++)if(!1===k[g].call(b,d))return!1;return!0}return G(a,d)};if(C&&5.8>C){g=j.createElement("iframe");g.src="javascript:true;";g=j.documentElement.firstChild.appendChild(g).contentWindow;g.storage=B;g.onload=p;var u=function(a,b,c,d){var e=g.document,f=["<script>","lfirst=1;",null,"storage="+A(b)+";","<\/script>"];if(c)g.lfirst?(history.back(),u(a,b,0,1)):(f[2]='parent.location.replace( "#'+a.replace(/"/g,'\\"')+'" );',e.open(),e.write(f.join("")),e.close());else if(h("#"+a).url!=h().url||
d){if(!g.lfirst)g.lfirst=1,u(h().url,g.storage,0,1);f[2]='parent.location.hash="'+a.replace(/"/g,'\\"')+'";';e.open();e.write(f.join(""));e.close()}};t=setInterval(r,100)}else D((b.addEventListener?"":"on")+"hashchange",r,!1);p();f.emulate=f.historyAPI=!0;f.pushState=function(a,f,c,k){c=c==q||null==c?e.basepath:c;c=c.replace(RegExp("^"+d.protocol+"//"+d.host+"/"),"/");0==c.indexOf("?")?c=h().pathname+c:0!=c.indexOf("/")&&(c=h().path+c);RegExp("^"+e.basepath).test(c)?c=c.replace(RegExp("^"+e.basepath),
e.type):d.href=c;a={state:a,title:f};g?(clearInterval(t),l=h("#"+c).url,u(c,a,k),t=setInterval(r,100)):(l=h("#"+c).url,k?(b.sessionStorage&&sessionStorage.removeItem(h().href),b.location.replace("#"+c)):b.location.hash=c,b.sessionStorage&&sessionStorage.setItem(h().href,A(a)));p();if(null!=f)j.title=f};f.replaceState=function(a,b,c){f.pushState(a,b,c,!0)}}})(window);
