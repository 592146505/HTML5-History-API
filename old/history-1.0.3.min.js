/*
 * history API JavaScript Library v1.0.3
 *
 * Copyright 2011, Dmitriy Pakhtinov
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Date: 25-08-2011
 */
(function(d){function g(a){return(a=a||e.location.hash)?String(a).replace(/^#\//,f.basepath).replace(/^#/,f.basepath):f.basepath}var r=!!(d.history&&history.pushState),o=null,e=d.document,j=false,s=true,k=[],f=function(){var a={},c,b,h="";c=e.getElementsByTagName("SCRIPT");for(b=0;c[b];b++)if(match=/(.*)\/history(?:-\d\.\d\.\d(?:\.min)?)?.js\?(.*)$/i.exec(c[b].src)){a.scriptpath=match[1]+"/";h=match[2];break}h=h.split("&");for(b=0;b<h.length;b++){c=h[b].split("=");a[c[0]]=c[1]||""}a.basepath=a.basepath||
"/";a.redirect=a.redirect||1;a.redirect=a.redirect=="true"||a.redirect==1?true:false;return a}();if(!d.history)d.history={};o=d.history;if(function(){if(r){if(g()!=f.basepath&&RegExp("^"+f.basepath+"$").test(e.location.pathname)){e.location=g();return false}if(!RegExp("^"+f.basepath).test(e.location.pathname)){e.location=String(e.location.pathname).replace(/^\//,f.basepath)+e.location.search;return false}}else if(e.location.pathname!=f.basepath&&f.redirect){e.location=f.basepath+"#"+String(e.location.pathname).replace(RegExp("^"+
f.basepath),"/")+e.location.search+e.location.hash;return false}return true}()&&!r){var i=g(),l=function(){for(var a=3,c=e.createElement("div"),b=c.getElementsByTagName("i");(c.innerHTML="<\!--[if gt IE "+ ++a+"]><i></i><![endif]--\>")&&b[0];);return a>4?a:false}(),n=Boolean(l);if(n&&l<8){var m;document.write('<iframe id="APIHistoryFrame" style="display:none;" src="javascript:true;"></iframe>');m=e.getElementById("APIHistoryFrame");var p=function(a){if(a!=m.contentWindow.curHash){m.contentWindow.document.open();
m.contentWindow.document.write('<script>window.curHash = "'+a+'"; parent.location.hash = "'+a+'"<\/script>');m.contentWindow.document.close()}};p(i)}var v=d.attachEvent?d.attachEvent:d.addEventListener||function(){},w=d.detachEvent?d.detachEvent:d.removeEventListener||function(){},x=d.fireEvent?d.fireEvent:d.dispatchEvent||function(){},q=function(a,c,b){if(a==="popstate"||a==="onpopstate"){k.push(c);if(s){s=false;g()!==f.basepath&&f.redirect&&setTimeout(function(){firePopState.call(d,generateLocation(g()))},
10)}}else v(a,c,b)},t=function(a,c,b){if(a==="popstate"||a==="onpopstate"){a=0;for(b=k.length;a<b;a++)if(k[a]===c){k.splice(a,1);break}}else w(a,c,b)},u=function(a,c){var b=!c&&a.type||a;if(b==="popstate"||b==="onpopstate")for(b=k.length;0<b;){if(c=c||(typeof a=="string"?d.event:a))try{c.target=d}catch(h){try{c.srcElement=d}catch(y){}}return k[0].call(d,c)}else return x(a,c)};if(d.attachEvent){d.attachEvent=q;d.detachEvent=t;d.fireEvent=u}else{d.addEventListener=q;d.removeEventListener=t;d.dispatchEvent=
u}generateLocation=function(a){var c,b,h;h=(c=a.split("?")).shift();c=(b=c.join("?").split("#")).shift();b=b.join("#");return{hash:b?"#"+b:"",host:e.location.host,hostname:"his.sp",href:e.location.protocol+"//"+e.location.host+a,pathname:h,port:e.location.port,protocol:e.location.protocol,search:c?"?"+c:"",toString:function(){return this.href}}};firePopState=function(a){if(document.createEvent){var c=document.createEvent("Events");c.initEvent("popstate",false,false);c.location=a;c.srcElement=d;d.dispatchEvent(c)}else if(document.createEventObject){c=
document.createEventObject();c.srcElement=d;c.location=a;c.type="popstate";d.fireEvent("popstate",c)}};hashChecker=function(){if(j)return false;j=true;var a=g();if(i!==a){i=a;firePopState(generateLocation(a))}else if(n&&l<8){a=(m.contentWindow.curHash||"/").replace(/^\//,f.basepath);if(i!==a){i=a;e.location.hash=i;firePopState(generateLocation(a))}}j=false;return true};n&&l<8?setInterval(hashChecker,100):q((d.attachEvent?"on":"")+"hashchange",hashChecker,false);o.pushState=function(a,c,b){for((a=
generateLocation(g()).pathname.split("/")).pop();j;);j=true;b=b.replace(RegExp("^"+e.location.protocol+"//"+e.location.hostname+"/"),"/");a=a.join("/")+"/";if(b.indexOf("/")<0){i=g(a+b);e.location.hash=a+b;n&&l<8&&p(a+b)}else if(RegExp("^"+f.basepath).test(b)){b=b.replace(RegExp("^"+f.basepath),"/");i=g(b);e.location.hash=b;n&&l<8&&p(b)}else e.location=b;i=g();j=false};o.replaceState=o.pushState}})(window);
